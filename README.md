# servicemanual-java

This is test application to create REST api backend for factory devices maintenance tasks using Java spring boot.
Application uses Java collections and streams to work with data and Mongo database for storing data.

Before starting the application you need Mongo database running on your local computer. See mongodb.com for instructions how to start your local database.
Application is configured to use local Mongo database, connection uri is located in application.properties file. 
Collections are save to database named backendtest. When started application searches for saved data and if not found it generates new factory device data from CSV file and then it generates maintenance tasks with random data.

Class packages:\
model\
    FactoryDevice holds Factory device information year, name, type and id for the data.\
    MaintenanceTask holds Factory device's maintenance task information. Id to which factory device it is related to, time when maintenance task was registered, severity, description, status of the task and id for the data.

controller\
    FactoryDeviceController for REST api to work with FactoryDevice data\
    MaintenanceTaskController for REST api to work with MaintenanceTasks.\
    FactoryDeviceNotFoundException, FactoryDeviceNotFoundAdvice and MaintenanceTaskNotFoundException classes are for exception handling.    

repository\
    FactoryDeviceRepository is used to store and read data from Mongo database.\
    MaintenanceTaskRepository is used to store and read data from Mongo database.\
    MongoSearchMaintenanceTaksRepository interface and implementation are for testin Mongo database Atlas cloud service aggregations. As a cloud service these can't be used with local database and this is not in use at the moment.

util\
    CSVReader is helping class to read CSV file.\
    MaintenanceTaskGenerator is helping class to fill MaintenanceTask repository with some random data.


Application starting point is in ServiceManualApplication class.
It uses local Mongo database to read backendtest database and FactoryDevices collection. If factorydevices collection is empty, then CSVReader class is used to read data from seeddata.csv file to fill factorydevices collection. Mongo database generates id data for each saved document. After saving collection it is then read back with that id data. Secondly maintenancetasks collection is filled with random data with the help of MaintenanceTaskGenerator class. This generator takes, how many tasks to generate and a list of factorydevice ids to connect tasks with as a parameter.
Lastly all maintenance tasks are printed out and REST api service is started.


REST API\
Content-type: application/json

Factorydevices\
Devices have name, year, type information and _id of the data, generated by Mongo db.

Data with datatypes:\
_id: String -Mongo database generated id of the data.\
name: String -Factory device name.\
year: int -Manufacturing year of the device.\
type: String -Type information of the device.

GET
/factorydevices
Get all factorydevices as JSON.

example:
[[\
    {\
        "_id": "6390072123cd3a655eb06839",\
        "name": "Device 0",\
        "year": 2004,\
        "type": "Type 19"\
    },\
    {\
        "_id": "6390072123cd3a655eb0683a",\
        "name": "Device 1",\
        "year": 1987,\
        "type": "Type 2"\
    },\
    {\
        "_id": "6390072123cd3a655eb0683b",\
        "name": "Device 2",\
        "year": 1982,\
        "type": "Type 11"\
}]

GET\
/factorydevices/{id}\
Get one factory device by id\
Example\
request:\
/factorydevices/6390072123cd3a655eb06839

response:\
{\
    "_id": "6390072123cd3a655eb06839",\
    "name": "Device 0",\
    "year": 2004,\
    "type": "Type 19"\
}

POST\
/factorydevices\
JSON data in body of the request.\
example\
request:\
{\
    "name": "Test device",\
    "year": 1982,\
    "type": "Test type"\
}

response\
{\
    "_id": "63901bb05f0eeb6f8bdb45f9",\
    "name": "Test device",\
    "year": 1982,\
    "type": "Test type"\
}


PUT\
/factorydevices/6390072123cd3a655eb06839\
Modify saved factory device\
Example:\
{\
    "name": "Test device modified",\
    "year": 1983, \
    "type": "Type 2"\
}

DELETE\
/factorydevices/6390072123cd3a655eb06839\
Removes factorydevice with id


Maintenancetasks\
Maintenance tasks are used to store all mainenance tasks of the factory devices.

Data with datatypes:\
factoryDeviceId: String -id of the factory device which this maintenance task concerns.\
severity: Enum { CRITICAL, IMPORTANT, UNIMPORTANT } -Severity of the task.\
status: Enum { OPEN, CLOSED } -Is the task open or closed.\
description: String -Description about the maintenance task.\
timestamp: Long -Timestamp when this maintenance task was registered. This is automatically generated when new tasks are posted.\
id: String -Mongo db generated id of the maintenance task.

/maintenancetasks\
Get all maintenance tasks as JSON.\
Tasks are sorted first with severity and secondly with registration time.

Example\
Response when three maintenance tasks are registered.\
[\
    {"factoryDeviceId":"638f028a35c5ce5d76cdc310","severity":"CRITICAL","description":"Maintenance task 3","status":"CLOSED","timestamp":1670316682770,"id":"638f028b35c5ce5d76cdc40c"},\
    {"factoryDeviceId":"638f028a35c5ce5d76cdc16c","severity":"CRITICAL","description":"Maintenance task 5","status":"OPEN","timestamp":1670316682777,"id":"638f028b35c5ce5d76cdc40e"},\
    {"factoryDeviceId":"638f028a35c5ce5d76cdc121","severity":"CRITICAL","description":"Maintenance task 6","status":"CLOSED","timestamp":1670316682781,"id":"638f028b35c5ce5d76cdc40f"}\
]

GET\
/maintenancetasks/{id}\
Get maintenance task with id\
Example\
request:\
get: /maintenancetasks/638f028b35c5ce5d76cdc42e

response:\
{\
    "factoryDeviceId":"638f028a35c5ce5d76cdc320",\
    "severity":"IMPORTANT",\
    "description":"Maintenance task 37",\
    "status":"CLOSED",\
    "timestamp":1670316682887,\
    "id":"638f028b35c5ce5d76cdc42e"\
}

POST\
/maintenancetasks\
Post new maintenance task\
JSON data in body of the request.\
factoryDeviceId -Which device maintenance task is related to\
severity -Severity of the task, CRITICAL, IMPORTANT and UNIMPORTANT\
status -status of the task OPEN or CLOSE\
Example\
request\
{\
    "factoryDeviceId": "63901213fff5e54e9dcf1abd",\
    "severity": "UNIMPORTANT",\
    "description": "Testing",\
    "status": "OPEN"\
}

response\
{\
    "factoryDeviceId": "63901213fff5e54e9dcf1abd",\
    "severity": "UNIMPORTANT",\
    "description": "Testing",\
    "status": "OPEN",\
    "timestamp": 1670386239530,\
    "id": "6390123ffff5e54e9dcf1ef5"\
}

PUT\
/maintenancetasks/6390123ffff5e54e9dcf1ef5\
Edit maintenance task by id\
Example\
request\
{\
    "factoryDeviceId": "63901213fff5e54e9dcf1abd",\
    "severity": "CRITICAL",\
    "description": "Testing again",\
    "status": "CLOSED"\
}

response\
{\
    "factoryDeviceId": "63901213fff5e54e9dcf1abd",\
    "severity": "CRITICAL",\
    "description": "Testing again",\
    "status": "CLOSED",\
    "timestamp": 1670386239530,\
    "id": "6390123ffff5e54e9dcf1ef5"\
}

DELETE\
Remove maintenance task with id\
request\
/maintenancetasks/6390123ffff5e54e9dcf1ef5



